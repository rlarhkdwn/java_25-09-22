package day18;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Objects;

public class Account {
	private String accountNum;
	private int money;
	private String filePath;
	
	public Account(String accountNum, String bankName, String owner) throws IOException {
		this.accountNum = accountNum;
		filePath = "D:\\web_0826_kkj\\memo\\" + bankName + "\\" + owner + "\\" + accountNum + ".txt";
		FileWriter fw = new FileWriter(filePath, true);
        fw.write("");
        fw.close();
        
	}
	
	public void load(String accountNum, String bankName, String owner) throws IOException {
		BufferedReader br = new BufferedReader(new FileReader("D:\\web_0826_kkj\\memo\\" + bankName + "\\" + owner + "\\" + accountNum));
		String line;
		String lastLine = "0";
        while (true) {
        	line = br.readLine();
            if (line == null) {
            	break;
            }
            System.out.println(line);
            lastLine = line;
        }
        String moneyStr = lastLine.split(" ")[lastLine.split(" ").length - 1];
        int moneyInt = Integer.parseInt(moneyStr);
        this.money = moneyInt;
	}
	
	public void print() {
		System.out.println("계좌번호 : " + accountNum + ", 잔액 : " + money);
	}
	
	public void plusMoney(int money) throws IOException {
		this.money += money;
		FileWriter fw = new FileWriter(filePath, true);
        fw.write("입금 : " + money + ", 잔액 : " + this.money + "\n");
        fw.close();
	}
	
	public void minusMoney(int money) throws IOException {
		this.money = Math.max(this.money - money, 0);
		FileWriter fw = new FileWriter(filePath, true);
        fw.write("출금 : " + money + ", 잔액 : " + this.money + "\n");
        fw.close();
	}
	
	public void sendMoney(String src, String dst, int money) throws IOException {
		this.money = Math.max(this.money - money, 0);
		FileWriter fw = new FileWriter(filePath, true);
        fw.write("송금[" + src + " -> " + dst + "] : " + money + ", 잔액 : " + this.money + "\n");
        fw.close();
	}
	
	public void receiveMoney(String src, String dst, int money) throws IOException {
		this.money += money;
		FileWriter fw = new FileWriter(filePath, true);
		fw.write("송금[" + src + " <- " + dst + "] : " + money + ", 잔액 : " + this.money + "\n");
        fw.close();
	}
	
	public void printTransactions() throws IOException {
		BufferedReader br = new BufferedReader(new FileReader(filePath));
		String line;
        while ((line = br.readLine()) != null) {
            System.out.println(line);
        }
	}
	
	public String getAccountNum() {
		return accountNum;
	}

	public void setAccountNum(String accountNum) {
		this.accountNum = accountNum;
	}

	public int getMoney() {
		return money;
	}

	public void setMoney(int money) {
		this.money = money;
	}

	@Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (!(obj instanceof Account)) return false;
        Account other = (Account) obj;
        return Objects.equals(this.accountNum, other.accountNum);
    }
	
	@Override
    public int hashCode() {
        return Objects.hash(accountNum);
    }
	
}
