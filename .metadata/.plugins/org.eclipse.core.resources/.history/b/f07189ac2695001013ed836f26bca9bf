package day18;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

public class Bank {
	private String bankName;
	private Map<String, Customer> customers = new HashMap<>();
	private List<Account> accounts = new ArrayList<>();
	
	public Bank(String bankName) {
		this.bankName = bankName;
	}
	
	public void addCustomer(Scanner scan) {
		System.out.print("이름 => ");
		String name = scan.nextLine();
		
		customers.put(name, new Customer(name));
	}
	
	public void createAccount(Scanner scan) {
		String name = scanName(scan);
		if (name == null) {
			return;
		}
		
		System.out.print("사용하실 계좌번호를 입력하세요 => ");
		String accountNum = scan.nextLine();
		
		if (accounts.contains(new Account(accountNum))) {
			System.out.println("이미 사용중인 계좌번호입니다.");
			return;
		}
		
		customers.get(name).addAccount(new Account(accountNum));	
		accounts.add(new Account(accountNum));
	}
	
	public void plusMoney(Scanner scan) {
		String name = scanName(scan);
		if (name == null) {
			return;
		}

		String accountNum = choiceAccount(scan, customers.get(name));
		if (accountNum == null) {
			return;
		}
				
		System.out.print("입금하실 금액을 입력하세요. => ");
		int money = scan.nextInt();
		scan.nextLine();
		
		customers.get(name).plusMoney(accountNum, money);
	}
	
	public void minusMoney(Scanner scan) {
		String name = scanName(scan);
		if (name == null) {
			return;
		}

		String accountNum = choiceAccount(scan, customers.get(name));
		if (accountNum == null) {
			return;
		}
				
		System.out.print("출금하실 금액을 입력하세요. => ");
		int money = scan.nextInt();
		scan.nextLine();
		
		int accountIdx = customers.get(name).getAccounts().indexOf(new Account(accountNum));
		
		if (customers.get(name).getAccounts().get(accountIdx).getMoney() < money) {
			System.out.println("잔액이 부족합니다.");
			return;
		}
		
		customers.get(name).minusMoney(accountNum, money);
	}
	
	public void sendMoney(Scanner scan, HashMap<String, Bank> bankMap) {
		// 송금자 선택
		String src = scanName(scan);
		if (src == null) {
			return;
		}
		
		// 송금 계좌 선택
		String accountNum = choiceAccount(scan, customers.get(src));
		if (accountNum == null) {
			return;
		}
		
		// 은행 리스트 출력
		System.out.println("=====은행 리스트=====");
		for (String bn : bankMap.keySet()) {
			System.out.println(bn);
		}
		
		// 은행 선택
		System.out.print("은행을 선택해주세요 => ");
		String bankname= scan.nextLine();
		
		if (!bankMap.keySet().contains(bankName)) {
			System.out.println("은행을 잘못 선택했습니다.");
			return;
		}
		Bank dstBank = bankMap.get(bankname);
				
		// 송금할 이름 선택
		String dst = scanName(scan);
		if (dst == null) {
			return;
		}
		
		// 송금 금액 입력		
		System.out.print("송금하실 금액을 입력하세요. => ");
		int money = scan.nextInt();
		scan.nextLine();
		
		// 잔액 확인
		int accountIdx = customers.get(src).getAccounts().indexOf(new Account(accountNum));
		if (customers.get(src).getAccounts().get(accountIdx).getMoney() < money) {
			System.out.println("잔액이 부족합니다.");
			return;
		}
		
		// 송금
		customers.get(src).sendMoney(accountNum, src, dst, money);
		dstBank.customers.get(dst).receiveMoney(accountNum, src, dst, money);
	}	
	
	
	public String scanName(Scanner scan) {
		System.out.print("이름 => ");
		String name = scan.nextLine();
		
		if (!customers.containsKey(name)) {
			System.out.println("해당 고객이 없습니다.");
			return null;
		}
		return name;
	}
	
	public String choiceAccount(Scanner scan, Customer customer) {
		int i = 1;
		System.out.println("=====계좌 목록=====");
		for (Account account : customer.getAccounts()) {
			account.print();
		}
		System.out.println();
		
		System.out.print("계좌번호를 입력해주세요. => ");
		String accountNum = scan.nextLine();
		
		if (!customer.getAccounts().contains(new Account(accountNum))) {
			System.out.println("계좌를 잘못 선택했습니다.");
			return null;
		}
		return accountNum;
	}

	public String getBankName() {
		return bankName;
	}

	public void setBankName(String bankName) {
		this.bankName = bankName;
	}

	public Map<String, Customer> getCustomers() {
		return customers;
	}

	public void setCustomers(Map<String, Customer> customers) {
		this.customers = customers;
	}

	public List<Account> getAccounts() {
		return accounts;
	}

	public void setAccounts(List<Account> accounts) {
		this.accounts = accounts;
	}
	
	
	
}